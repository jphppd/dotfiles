#!/usr/bin/env bash
# shellcheck disable=SC1090,SC1091
#
# executed by bash(1) for login-shells
#

should_launch_ssh_agent() {
  [[ -x /usr/bin/ssh-agent ]] && [[ -z "${SSH_AGENT_PID}" ]] && [[ -z "${SSH_TTY}" ]]
}

should_run_display() {
  if [[ "$UID" -ne 0 ]] && [[ -z $DISPLAY ]] && [[ $(tty) == "/dev/tty1" ]]; then
    [[ -x /usr/bin/startx ]] || [[ -x /usr/local/bin/sway ]]
  else
    false
  fi
}

if [[ -f "${HOME}/.bashrc" ]] && [[ "$-" == *i* ]]; then
  source "${HOME}/.bashrc"
fi

if should_launch_ssh_agent; then
  eval "$(/usr/bin/ssh-agent)"
fi

if should_run_display; then
  if [[ -x /usr/local/bin/sway ]]; then
    exec /usr/local/bin/sway
  else
    exec /usr/bin/startx
  fi
fi
